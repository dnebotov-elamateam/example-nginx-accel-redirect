version: '3'

services:
  ingress:
    image: nginx:latest
    environment:
      - NGINX_PORT=80
    volumes:
      - ./etc/ingress/templates:/etc/nginx/templates:ro
    ports:
      - 8000:80
    depends_on:
      - api-gateway
      - s3

  api-gateway:
    build: .
    environment:
      - S3_ACCESS_KEY=
      - S3_SECRET_KEY=
      - S3_ADDRESS=
      - S3_FILE_PATH=
    ports:
      - 9010:9090
    depends_on:
      - s3

  s3:
    image: quay.io/minio/minio:RELEASE.2022-05-26T05-48-41Z
    command: server --console-address ":9001" /data
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin
    ports:
      - 9020:9000
      - 9021:9001